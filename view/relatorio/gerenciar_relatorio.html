<body class="container-fluid" id="relatorios">


<h3><a href="index.php?pag=DashBoard"><span class="glyphicon glyphicon-chevron-left"></span> Voltar </a> | Relatórios</h3>

<p>Periodo:
    <select id="periodo" onchange="getPeriodoSelecionado();">

    </select>
</p>

<p>Total de Alunos :  <span id="totalAlunosAtivos"></span> Alunos.</p>
<h3 class="text-center">Alunos por Oficina</h3>

<div class="row">
    <table width="80%" align="center" class="">
        <thead>
        <tr>
            <th class="col-md-2">Oficna</th>
            <th class="col-md-2">Número de Alunos</th>
        </tr>
        </thead>
        <tbody id="alunosPorOficina">
        </tbody>
    </table>
</div>

<script type="application/javascript">
    $(document).ready(loaderRelatorios);

    function loaderRelatorios() {
        ajaxLoadGET('control/main.php?req=selectTempoHistorico', parsePeriodosSelect, '#periodo',getPeriodoSelecionado);
    }

    function getPeriodoSelecionado() {
        let periodo = $('#periodo').val();

        ajaxLoadGET('control/main.php?req=relAlunosPorTurmaPeriodo&id='+periodo, jsonParseAlunosPorOficinas, '#alunosPorOficina');
        function jsonParseAlunosPorOficinas(resposta,corpo) {
            let objJson = JSON.parse(resposta);
            let soma = 0;
            for(i in objJson){
                corpo.append(
                    '<tr>\n' +
                    '     <td class="col-md-2">' + objJson[i].oficina + '</td>\n' +
                    '     <td class="col-md-2">' + objJson[i].alunos + '</td>\n' +
                    '</tr>');
                soma += parseInt(objJson[i].alunos);
            }
            $('#totalAlunosAtivos').empty().
            append(soma);
        }
    }

</script>
</body>