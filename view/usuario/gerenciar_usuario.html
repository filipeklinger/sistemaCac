<body class="container-fluid usuario">
<!--div class="col-md-0-5 sidebar">
    sidebar place -holder
</div-->
<div class="header">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div>
                <ul class="nav navbar-nav">
                    <li><a href="index.php?pag=DashBoard"><i class="glyphicon glyphicon-home"></i> Página
                        Inicial</a></li>
                    <li class="active"><a data-toggle="tab" onclick="trocaReq('todos')" href="#">Todos</a></li>
                    <li class=""><a data-toggle="tab" onclick="trocaReq('candidato')" href="#">Gerenciar
                        Candidato</a></li>
                    <li class=""><a data-toggle="tab" onclick="trocaReq('professor')" href="#">Gerenciar
                        Professores</a></li>
                    <li class=""><a data-toggle="tab" onclick="trocaReq('administrador')" href="#">Gerenciar
                        Adminstradores</a></li>
                </ul>
            </div>
        </div>
    </nav>
</div>
<p id="avisos"></p>

<div style="overflow-x: hidden;">
    <div id="contTab" class="tab-content" style="padding: 20px;">
        <div id="users" class="tab-pane fade in active">

            <div class="col-md-2">
            <a href="?pag=Cad.Pessoa" type="button" class="btn btn-primary"><i
                    class="glyphicon glyphicon-plus"></i> Novo Usuário</a>
            </div>
            <div class="col-md-5 searchBox">
                <input type="text" class="searchBox" id="searchName" onclick="limpaPesquisa();" placeholder="Buscar ...">
                <button id="bt-pesquisa" type="button" onclick="pesquisa()" disabled>Pesquisa</button>
            </div>

            <br>
            <table class="table">
                <thead>
                <tr>
                    <th class="col-md-4">Nome</th>
                    <th class="col-md-2">Tipo de Acesso</th>
                    <th class="col-md-2">Menor de Idade ?</th>
                    <th class="col-md-2">Discente da Rural ?</th>
                    <th class="col-md-2">Ver / Editar dados</th>
                </tr>
                </thead>
                <tbody id="usuarios"></tbody>
            </table>

        </div>
    </div>
    <div class="container-fluid text-center">
        <ul class="pagination coolPaginator" id="paginador">
            <!--li><a href="#" onclick="trocaPag(1)" id="goFirst"><span class="fa fa-chevron-left"></span></a></li-->
            <li><a href="#" onclick="trocaPag(pagina-1)" id="goBack"><span class="fa fa-chevron-left"></span></a></li>
            <!--li><span style="color: #0f0f0f"><span id="paginic">1</span> de <span id="pagfim">N</span></span></li-->
            <li>
                <span>
                    <span>
                        <input id="paginic" type="text" onchange="trocaPag(parseInt($(this).val()))">
                    </span>
                    de
                    <span id="pagfim">
                        N
                    </span>
                </span>
            </li>
            <li><a href="#" onclick="trocaPag(pagina+1)" id="goNext"><span class="fa fa-chevron-right"></span></a></li>
            <!--li id="goLast"></li-->
        </ul>
    </div>
</div>
<script type="text/javascript">
    var totalpaginas = 1;
    var pagina = 1;
    var nivel = "todos";

    $(document).ready(usuariosLoader(), $('#paginic').val(pagina));

    function usuariosLoader() {
        carregaUsuarios();
        ajaxLoadGET('control/main.php?req=getPageNumber&nivel='+nivel, setPaginador, '#cadastrosRuralino');
    }

    function trocaPag(pag) {
        if(pag <= totalpaginas && pag > 0)pagina = pag;
        //$('#paginic').empty().append(pagina);
        console.log(pag);
        $('#paginic').empty().val(pagina);
        carregaUsuarios();
    }
    function trocaReq(req) {
        nivel=req;pagina=1;//reseta o numero de paginas
        carregaUsuarios();
        //recarregando o paginador
        ajaxLoadGET('control/main.php?req=getPageNumber&nivel='+nivel, setPaginador, '#cadastrosRuralino');
    }
    function carregaUsuarios() {
        ajaxLoadGET('control/main.php?req=selectUsuario&nivel=' + nivel +'&pagina='+pagina, jsonParseUsuarios,'#usuarios');
    }
    function pesquisa() {
        $('#bt-pesquisa').attr("disabled","disabled");//importante para nao envia 2 requisicoes iguais
        let nome = $('#searchName').val();
        ajaxLoadGET('control/main.php?req=selectUsuario&nivel=' + nivel +'&nome='+nome, jsonParseUsuarios,'#usuarios');
    }
    function limpaPesquisa() {
        $('#bt-pesquisa').removeAttr("disabled");
        $('#searchName').val('');
        //trocaReq('selectTodos');
    }

    function setPaginador(resposta) {
        let objJson = JSON.parse(resposta);
        let registros = objJson[0].total;
        totalpaginas = parseInt(registros / 25);
        if(totalpaginas == 0) totalpaginas = 1;
        $('#paginic').empty().append(pagina);
        $('#pagfim').empty().append(totalpaginas);
        $('#goLast').empty().append('<a href="#" onclick="trocaPag('+totalpaginas+')" id="goLast">&raquo;</a>');
    }
</script>
</body>
